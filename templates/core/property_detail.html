{% extends "core/base.html" %}
{% load static %}

{% block content %}

<style>
  body {
    background-color: #f2f4f8;
    font-family: 'Segoe UI', sans-serif;
  }
  .property-image-wrapper {
    width: 100%;
    aspect-ratio: 3 / 2; /* 600x400 oranı */
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    border-radius: 12px;
  }

  .property-container {
    max-width: 1200px;
    margin: 50px auto;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    overflow: hidden;
    padding: 30px;
  }

  .property-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background-color: #fff;
  }

  .info-section {
    display: flex;
    flex-wrap: wrap;
    gap: 30px;
  }

  .left-section {
    flex: 1 1 45%;
  }

  .right-section {
    flex: 1 1 50%;
  }

  .property-title {
    font-size: 28px;
    font-weight: 700;
  }

  .property-price {
    font-size: 24px;
    color: #28a745;
    font-weight: 600;
  }

  .description {
    margin: 25px 0;
  }

  .icon-text {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
    color: #333;
    font-size: 16px;
  }

  .btn-back {
    margin-top: 20px;
  }

  .share-buttons a {
    margin-right: 10px;
    font-size: 18px;
  }

  iframe {
    border-radius: 10px;
  }

  .owner-info {
    margin-top: 20px;
    padding: 15px;
    background: #f9f9f9;
    border-radius: 10px;
  }

  .owner-info h6 {
    font-weight: 600;
    margin-bottom: 10px;
  }

  @media (max-width: 768px) {
    .info-section {
      flex-direction: column;
    }

    .left-section, .right-section {
      flex: 1 1 100%;
    }

    .property-image {
      height: 250px;
    }
  }
  .thumb-preview {
  width: 80px;
  height: 60px;
  object-fit: contain;
  background-color: #fff;
  border: 1px solid #ddd;
}
.carousel-control-prev-icon,
.carousel-control-next-icon {
  background-color: rgba(0, 0, 0, 0.6); /* siyah yarı saydam */
  border-radius: 50%;
  padding: 10px;
  width: 40px;
  height: 40px;
}
.carousel-control-prev-icon:hover,
.carousel-control-next-icon:hover {
  background-color: rgba(0, 0, 0, 0.8);
}
.seller-message {
  font-size: 15px;
  line-height: 1.6;
  color: #333;
}
.seller-message h6 {
  font-weight: 600;
  color: #555;
}


</style>

<div class="property-container">
  <div class="info-section">

<!-- Sol: Görsel Alanı -->
<div class="left-section">
  {% if property.images.all %}
    <div id="propertyCarousel" class="carousel slide mb-3 position-relative" data-bs-ride="carousel">
      <div class="carousel-inner">
        {% for image in property.images.all %}
          <div class="carousel-item {% if forloop.first %}active{% endif %}">
            <div class="property-image-wrapper">
                <img 
                  src="{{ image.image.url }}" 
                  class="d-block w-100 property-image carousel-main-img" 
                  alt="İlan Fotoğrafı"
                  data-bs-toggle="modal" 
                  data-bs-target="#imageModal"
                  data-img-url="{{ image.image.url }}"
                >
              </div>
          </div>
        {% endfor %}
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#propertyCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Önceki</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#propertyCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Sonraki</span>
      </button>

      <!-- Büyütme İkonu -->
      <button class="btn btn-light position-absolute top-0 end-0 m-2 shadow" 
              style="z-index: 10;" 
              data-bs-toggle="modal" 
              data-bs-target="#imageModal"
              id="enlargeBtn">
        <i class="bi bi-arrows-fullscreen"></i>
      </button>
    </div>

    <!-- Thumbnail'lar -->
    <div class="d-flex flex-wrap gap-2 justify-content-start">
      {% for image in property.images.all %}
        <img 
          src="{{ image.image.url }}" 
          class="img-thumbnail thumb-preview" 
          data-bs-target="#propertyCarousel" 
          data-bs-slide-to="{{ forloop.counter0 }}" 
          style="width: 80px; height: 60px; cursor: pointer; object-fit: cover;"
        >
      {% endfor %}
    </div>
    <!-- Satıcı Mesajı -->
    {% if property.owner_message %}
    <div class="seller-message mt-3 p-3 border rounded bg-light">
      <h6 class="mb-2">Satıcıdan Mesaj</h6>
      <p class="mb-0">{{ property.owner_message }}</p>
    </div>
    {% endif %}

  {% else %}
    <img src="{{ property.image.url }}" alt="{{ property.title }}" class="property-image">
  {% endif %}
</div>




    <!-- Sağ: Detaylar -->
    <div class="right-section">
      <h1 class="property-title">{{ property.title }}</h1>
      <p class="property-price">{{ property.price }} TL</p>

      <div class="icon-text">
        <i class="bi bi-geo-alt-fill"></i> {{ property.city }}
      </div>
      <div class="icon-text">
        <i class="bi bi-house-door-fill"></i> {{ property.bedrooms }} Oda
      </div>
      <div class="icon-text">
        <i class="bi bi-droplet-half"></i> {{ property.bathrooms }} Banyo
      </div>
      <div class="icon-text">
        <i class="bi bi-calendar-event-fill"></i> Yayınlanma: {{ property.created_at|date:"d M Y" }}
      </div>

      <!-- Açıklama -->
      <div class="description">
        <h5>İlan Açıklaması</h5>
        <p class="text-muted">{{ property.description }}</p>
      </div>

      <!-- Paylaş Butonları -->
      <div class="share-buttons mb-3">
        <h6>Paylaş:</h6>
        <a href="https://api.whatsapp.com/send?text={{ request.build_absolute_uri }}" target="_blank" class="btn btn-success btn-sm">
          <i class="bi bi-whatsapp"></i> WhatsApp
        </a>
        <a href="mailto:?subject={{ property.title }}&body={{ request.build_absolute_uri }}" class="btn btn-outline-secondary btn-sm">
          <i class="bi bi-envelope"></i> Mail
        </a>
      </div>

      <!-- İlan Sahibi -->
      <div class="owner-info">
        <h6>İlan Sahibi</h6>
        <p><strong>Ad:</strong> {{ property.owner.get_full_name }}</p>
        <p><strong>Email:</strong> {{ property.owner.email }}</p>
        <p><strong>Telefon:</strong> {{ property.owner.profile.phone_number }}</p>
      </div>

      <!-- Geri Dön Butonu -->
      <div class="btn-back">
        <a href="{% url 'all_properties' %}" class="btn btn-outline-primary">← Tüm ilanlara dön</a>
      </div>
    </div>
  </div>

  <!-- Harita -->
  <div class="mt-5">
    <h5>Konum</h5>
    <iframe 
      src="https://www.google.com/maps?q={{ property.city|urlencode }}&output=embed" 
      width="100%" 
      height="300" 
      allowfullscreen="" 
      loading="lazy"
      referrerpolicy="no-referrer-when-downgrade">
    </iframe>
  </div>
</div>
<!-- Fotoğraf Büyütme Modali -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content bg-dark">
      <div class="modal-body p-0">
        <img id="modalImage" src="" class="w-100" style="object-fit: contain; max-height: 90vh;">
      </div>
      <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
  </div>
</div>
<script>
  const enlargeBtn = document.getElementById('enlargeBtn');
  const modalImage = document.getElementById('modalImage');
  const carouselMainImg = document.querySelector('.carousel-item.active img');

  // Büyütme butonuna tıklanınca aktif görseli al
  enlargeBtn.addEventListener('click', () => {
    const activeImage = document.querySelector('.carousel-item.active img');
    if (activeImage) {
      modalImage.src = activeImage.getAttribute('src');
    }
  });

  // Görselin kendisine tıklanırsa da açılacak şekilde ayarla
  document.querySelectorAll('.carousel-main-img').forEach(img => {
    img.addEventListener('click', () => {
      modalImage.src = img.getAttribute('src');
    });
  });
</script>





{% endblock %}